# -----------------------------------------------------------------------------
#                        SLAM system definition for MOLA
# This file defines an input dataset from a video file.
# No actual SLAM or localization defined in this file!
#
# Invoke setting VIDEO_INPUT_URI to the path where the video is stored or
# RSTP video stream URI for IP cameras, e.g:
#
#   VIDEO_INPUT_URI=/path/to/my/video.mp4 mola-cli video_file_source_just_replay.yaml
#
# -----------------------------------------------------------------------------

modules:
  # =====================
  # VideoDataset
  # =====================
  - name: video_input
    type: mola::VideoDataset
    # *Important*: For video file sources, this will be the rate at which frames will be published:
    execution_rate: 50 # Hz

    # (The following requires creating a MolaViz instance)
    gui_preview_sensors:
      - raw_sensor_label: cam0
        decimation: 1
        win_pos: 5 80 500 200 # [x,y,width,height]
    params:
      input_mode: "mola::InputMode::VideoFile" # 'ImageDirectory|VideoFile|LiveCamera'
      sensor_label: cam0

      video_uri: ${VIDEO_INPUT_URI} # Path to the video file, or rtsp stream URI.

      time_warp_scale: 1.0
      start_paused: ${MOLA_DATASET_START_PAUSED|false}

      # The camera pose on the vehicle/robot frame:
      camera_pose: "0 0 0 -90 0 -90" # 'x y z yaw_deg pitch_deg roll_deg'

      # The following parameters are used to set the camera intrinsics of published images:
      camera_model:
        image_width: 800
        image_height: 600
        camera_matrix:
          cols: 3 # [ fx, 0, cx ]
          rows: 3 # [ 0, fy, cy ]
          #         [ 0,  0,  1 ]
          data: [500, 0, 400, 0, 500, 300, 0, 0, 1]
        # Disttortion model:
        #  - none: images are undistorted. Coefficients are ignored.
        #  - plumb_bob: [k1, k2, p1, p2, k3] 5-param Brown-Conrady or Plumb-Bob pinhole distortion model:
        #  - kannala_brandt: [k1, k2, k3, k4] 4-parameter Kannala Brandt distortion model (fisheye):
        distortion_model: none
        distortion_coefficients:
          cols: 4
          rows: 1
          data: [0.0, 0.0, 0.0, 0.0]
        camera_name: "my_camera" # Identifier for the camera, not used here but must be provided.

  # =====================
  # MolaViz
  # =====================
  - name: viz
    type: mola::MolaViz
    #verbosity_level: DEBUG
    params: ~ # none
